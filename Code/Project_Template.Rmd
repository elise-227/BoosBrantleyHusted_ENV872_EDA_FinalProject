---
output: 
  pdf_document:
    keep_tex: yes
    fig_caption: yes
    number_sections: yes
geometry: margin=2.54cm
title: "Insert title of project here"
subtitle: "Web address for GitHub repository"
author: "Elise Boos, Andrew Brantley, Kelsey Husted"
fontsize: 12pt
mainfont: Times New Roman
editor_options: 
  chunk_output_type: console
---

\newpage
\tableofcontents 
\newpage
\listoftables 
\newpage
\listoffigures 
\newpage

```{r setup, include=FALSE}
# Set your working directory
getwd()

# Load your packages
library(tidyverse)
library(lubridate)
library(zoo)
library(trend)
library(dygraphs)
library(xts)
library(ggfortify)
require(dplyr)
library(Kendall)
library(tseries)
require(sf)
require(leaflet)
require(mapview)
mapviewOptions(fgb = FALSE)

# Set your ggplot theme

my_theme <- theme_classic(base_size = 14) +
  theme(axis.text = element_text(color = "black"), 
        legend.position = "bottom", legend.text=element_text(size=8), 
        legend.title=element_text(size=10), panel.background = element_rect(fill = "gray95"), 
        panel.grid.major = element_line(size = 0.6, linetype = 'solid', colour = "white"))

theme_set(my_theme)

# Load your datasets
#New York Data
NY_Discharge <- read.csv("../Data/Raw/NY_MeanDailyDischarge.csv", stringsAsFactors = TRUE)

#North Carolina Data
<<<<<<< HEAD
NC_Discharge <- read.csv("../Data/Raw/NC_Discharge_NewRiver_RAW.csv", stringsAsFactors = TRUE)
=======
NC_Discharge <- read.csv("Data/Raw/NC_Discharge_NewRiver_RAW.csv", stringsAsFactors = TRUE)

#Florida data
#read in both sheets of the data since data was too big to fit on one
florida_part2 <- read.csv("../Data/Raw/florida_round2.csv", stringsAsFactors = T)
florida_part2_join <- read.csv("../Data/Raw/florida_round2_1.csv", stringsAsFactors = T)
#join the two datasets
join <- rbind(florida_part2, florida_part2_join)
>>>>>>> 8baa879f6ae7652148b2715bd287cbba92f89717
```


# Rationale and Research Questions

Hurricanes are a serious natural disaster that often affects millions each year up and down the East Coast of the United States. Understanding how climate change is impacting the trends of hurricanes will be important information for strategic planning to protect both property and lives into the future. For this analysis we chose to look at discharge data of major rivers in states spanning the East Coast of the US in order to gain ome information on how locality and intensity of these hurricanes may be changing over the past three decades. 

We chose to investigate discharge data in Florida, North Carolina, and New York to gain an understanding of how hurricane regimes may be changing across the entire span of the coast. Furthermore, the comparative study will reveal if hurricanes are shifting poleward. Our central research questions revolved around investigating any increasing trends in discharge during the hurricane season (June-October) and where these increasing trends were more intense. 

## Research Questions

## Question 1: Has there been an overall increase in mean daily discharge during the Atlantic hurricane season from 1990 - 2021?

## Question 2: Has one portion of the East Coast of the US eperienced a disproportionate increase in hurricane activity, and its associated discharge, compared to other portions commonly affected by these hurricanes?

Are the general locations of hurricanes shifting towards the poles in the northern &/or southern hemisphere?

\newpage

# Dataset Information

All datasets used in this analysis were downloaded from the USGS website, specifically from their historical records of discharge data recorded by field dataloggers. The data was obtained from three states varying in latitude along the East Coast (i.e., Florida, North Carolina, and New York). Stream gage locations were selected based on proximity to major river basins and vulnerable counties susceptible to hurricane impacts. Additionally, Gage locations were chosen with sufficient data, going back to at least the 1990s. Similar timeline ranges for the datatsets ensures a time series analysis that is comparable among all three sites. Discharge data was the data type used in this analysis with all datasets having at minimum daily recordings but some having recordings as often as every 30 minutes. 

\newpage

#Data Wrangling
```{r NY Wrangle}

```

```{r NC Wrangle}

```

```{r FL Wrangle}
#clean the original florida dataset
florida_clean <- join %>%
  mutate(Date = ymd(Date)) %>%
  mutate(State = "Florida") %>%
  select(State, Date, Discharge)
#days with multiple observations summarise to get mean and filter out only hurricane months
florida_hurricane <- florida_clean %>%
  group_by(Date) %>%
  summarise(Daily_Discharge = mean(Discharge)) %>%
  mutate(month = month(Date)) %>%
  filter(month >= 6 & month <= 10) 
#create a date dataframe of timespan
Date  <- seq(as.Date("1987-01-01"),as.Date("2021-10-31"), by = "days")
Dates <- as.data.frame(Date)
#filter out hurricane months
date_join <- Dates %>%
  mutate(month = month(Date)) %>%
  filter(month >= 6 & month <= 10) %>%
  select(1)
#join the data sets to allow us to know which days don't have observations
#interpolate the days with NAs
fh_clean <-left_join(date_join, florida_hurricane, by = "Date")
fh_clean <- fh_clean %>%
  select(1,2) %>%
  mutate(Daily_Discharge_clean = zoo::na.approx(Daily_Discharge))
#save to processed folder 
write.csv(fh_clean, "../Data/Processed/flordia_1987_processed.csv")
#trimming data set for comparison, starting at 1990
florida_1990_edit <- fh_clean %>%
  mutate(year = year(Date)) %>%
  filter(year >= 1990) 
#save to processed folder 
write.csv(florida_1990_edit, "../Data/Processed/flordia_1990_processed.csv")
```


\newpage

# Exploratory Analysis 

```{r map of locations}
site_locations <- read.csv("../Data/Raw/Site_locations.csv", stringsAsFactors = T)
site_locations.sf <- site_locations %>%
st_as_sf(coords = c('Long','Lat'),
         crs=4269)
mapview(site_locations.sf[1,], zcol = "Site.Name", col.regions = "deeppink1") +
mapview(site_locations.sf[2,], zcol = "Site.Name", col.regions = "turquoise4") +
mapview(site_locations.sf[3,], zcol = "Site.Name", col.regions = "green")
```

```{r ex an FL}
#plot discharge before running time series on the log scale
ggplot(florida_1990_edit, aes(x = Date, y = log(Daily_Discharge_clean)))+
  geom_point(color = "deeppink1")+
  geom_smooth(method = lm, color = "black")+
  labs(title = "Discharge in Florida during Hurricane Months")+
  xlab("Date") +
  ylab("Mean Daily Discharge (cfs)")
```


\newpage

# Analysis
```{r NY analysis}

```

```{r NC analysis}


<<<<<<< HEAD
```{r}
NonSeasonal.Plot <- ggplot() +
  geom_point(aes(NY_Combine_Nonseasonal$Date, NY_Combine_Nonseasonal$Nonseasonal), 
             alpha = 1) + 
  geom_smooth(method = "lm", color = "turquoise4") +
  labs(x = "Date", y = "Non-Seasonal Daily Discharge (cfs)", 
       title = "Non-Seasonal Mean Daily Discharge During Hurricane Seasons", 
       subtitle = "All Research Locations") +
  scale_y_log10() +
  scale_x_date(date_labels = "%Y", date_breaks = "2 year") +
  theme(axis.text.x = element_text(angle = 90)) 
print(NonSeasonal.Plot)

=======
```

```{r FL analysis}
#regular time series
florida_hurricane_ts <- ts(florida_1990_edit$Daily_Discharge_clean, start=c(1990,6), frequency = 153)  
florida_hurricane_ts

#decomposed time series
florida_hurricane_Decomposed <- stl(florida_hurricane_ts, s.window = "periodic")
plot(florida_hurricane_Decomposed)
#filtering out seasonal data
florida_hurricane_Decomposed_Components <- as.data.frame(florida_hurricane_Decomposed$time.series[,2:3])
florida_hurricane_Decomposed_Components <- florida_hurricane_Decomposed_Components %>%
  mutate(data = trend + remainder) 
#add date column
florida_hurricane_Decomposed_Components <- mutate(florida_hurricane_Decomposed_Components,
                        Date = florida_1990_edit$Date)

#run time series on new data with seasonal removed
nonseasonal_data_florida_ts <- ts(florida_hurricane_Decomposed_Components$data,
                                start=c(1990,6),
                                frequency=153) 
plot(nonseasonal_data_florida_ts)

#look for trend and significance 
florida_trend <- MannKendall(nonseasonal_data_florida_ts)
florida_trend
summary(florida_trend)

#plot of nonseasonal trend
FL_NonSeasonal.Plot <- ggplot(florida_hurricane_Decomposed_Components, aes(x = Date, y = data)) +
  scale_y_log10() +
  geom_point(color = "deeppink1", size = 0.6) +
  labs(x = "Date", y = "Non-Seasonal Daily Discharge (cfs)", 
       title = "Non-Seasonal Mean Daily Discharge During Hurricane Seasons", 
       subtitle = "North Prong St. Sebastian River, Florida") +
  geom_smooth(method = "lm", color = "black") +
  scale_x_date(date_labels = "%Y", date_breaks = "2 year") +
  theme(axis.text.x = element_text(angle = 90)) 
plot(FL_NonSeasonal.Plot)                               
```

```{r combined plot}
combined_NonSeasonal.Plot <- ggplot(florida_hurricane_Decomposed_Components, aes(x = Date, y = data)) +
  scale_y_log10() +
  geom_point(alpha = 0.0) +
  geom_smooth(method = "lm", color = "deeppink1") +
 # geom_point(NY_Combine_Nonseasonal, aes(x = Date, y = Nonseasonal), alpha = 0.0) + 
 # geom_smooth(method = "lm", color = "turqouise4") +
   labs(x = "Date", y = "Non-Seasonal Daily Discharge (cfs)", 
       title = "Non-Seasonal Mean Daily Discharge During Hurricane Seasons")
  scale_x_date(date_labels = "%Y", date_breaks = "2 year") +
  theme(axis.text.x = element_text(angle = 90)) 
plot(combined_NonSeasonal.Plot)
>>>>>>> 8baa879f6ae7652148b2715bd287cbba92f89717
```


\newpage

# Summary and Conclusions


\newpage

# References
<add references here if relevant, otherwise delete this section> 
